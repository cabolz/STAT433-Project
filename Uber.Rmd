---
title: "Uber"
output: html_document
---

```{r message=FALSE, warning=FALSE}
library(dplyr)
library(readr)
library(tidyverse)
```


```{r message=FALSE}
location<-read_csv("uber-raw-data-apr14.csv") 

brokenUp<-location %>% 
  separate("Date/Time", into = c("Date","Time"),sep=" ")%>%
  mutate("date"=Date) %>% 
  separate("date", into = c("month","day","year"),sep="/")%>% 
  separate(Time, into = c("hour","minute"),sep=":")

loc2<-read_csv("uber-raw-data-may14.csv")

brokenUp2<-loc2 %>% 
  separate("Date/Time", into = c("Date","Time"),sep=" ")%>%
  mutate("date"=Date) %>% 
  separate("date", into = c("month","day","year"),sep="/")%>% 
  separate(Time, into = c("hour","minute"),sep=":")
```


```{r message=FALSE}
uberDataSet<-full_join(brokenUp,brokenUp2)
```

I found some data on weather in New York City but it was from 2012 to 2017 so I had to cut some of the fat out
```{r message=FALSE}
hum<-read_csv("humidity.csv")

Humidityin2014<-hum %>% 
  separate("datetime", into = c("Date","hour"), sep = " ") %>% 
  separate("Date", into = c("month","day","year"),sep="/") %>% 
  filter(year==14) %>% 
  mutate(Humidity = `New York`) %>% 
  transmute(hour,day,month,year,Humidity)

Sky<-read_csv("weather_description.csv")

JustNewYorkSky<-Sky %>% 
  separate("datetime", into = c("Date","hour"), sep = " ") %>% 
  separate("Date", into = c("month","day","year"), sep="/") %>% 
  filter(year==14) %>% 
  mutate(SkyDesciption=`New York`) %>% 
  transmute(hour,day,month,year,SkyDesciption)

temp<-read_csv("temperature.csv")

JustTemp<-temp %>% 
  separate("datetime", into = c("Date","hour"), sep=" ") %>% 
  separate("Date", into = c("month","day","year"),sep="/") %>% 
  filter(year==14) %>% 
  transmute(hour,day,month,year,`New York`) %>% 
  mutate(temperature=((`New York`-273.15)*9/5)+32) %>% 
  transmute(hour,day,month,year,temperature)

d<-full_join(Humidityin2014,JustNewYorkSky)

weatherData<-full_join(d,JustTemp) %>% 
  separate(hour,into = c("hour"),sep = ":")
```

Uber and Weather together
```{r warning=FALSE}
UberandWeather<-uberDataSet %>% 
  full_join(weatherData) 

UberandWeather <- subset(UberandWeather, select = c("hour", "minute", "Lat", "Lon", "month", "day", "Humidity", "SkyDesciption", "temperature"))

UberandWeather <- na.omit(UberandWeather)

```


```{r}
write_csv(UberandWeather, "UberandWeather.csv")
```

```{r}
UberandWeather %>% summarise(sum(is.na(Humidity)))
```
# of NA's
date = 4369
hour = 0
minute = 4369
Lat = 4369
Lon = 4369
month = 0
day = 0
year = 0
Humidity = 22010
SkyDescription = 0
temperature = 0


Trying to get the NYC map
```{r}
library(tigris)
library(dplyr)
library(leaflet)
library(sp)
library(ggmap)
library(maptools)
library(broom)
library(httr)
library(rgdal)
leaflet() %>%
  addTiles() %>%
  setView(-74.00, 40.71, zoom = 12)
```

```{r}
library(ggplot2)

sum<-UberandWeather %>%
  filter(month == 5) %>% 
  group_by(day) %>% 
  summarize(pickup=n(), temp = mean(temperature))

sum$day = as.numeric(sum$day)

ggplot(sum, aes(x = day, y = pickup, fill = temp)) +
  geom_col() +
  scale_fill_gradient(low = "white", high = "red") +
  labs(
    title = "Number of Uber Pickups in NYC in May 2014",
    x = "Day of the Month",
    y = "Number of Pickups",
    fill = "Temperature") +
  scale_x_continuous(breaks = waiver(), n.breaks = 6)
```
Trying to put these datasets together
```{r}
UberandWeather
W<-UberandWeather %>% 
  mutate(long = Lon) %>% 
  mutate(lat = Lat)
sixdecimalplaces<-nyc_neighborhoods_df %>% 
  mutate(long = round(nyc_neighborhoods_df$long,4), lat = round(nyc_neighborhoods_df$lat,4))
byCounty<- sixdecimalplaces %>% #this finally works
  right_join(W)
byCounty
missing<-byCounty %>% 
  transmute(miss = sum(is.na(id)))
missing
char<-c(0:309)
nyc_neighborhoods$id=as.character(char)
nyc_neighborhoods
justCountyand

countyAndBorough<-justCountyand %>% 
  full_join(byCounty)
countyAndBorough
curiosity<-countyAndBorough %>% 
  filter(nyc_neighborhoods.borough == 'Manhattan')
curiosity


library(data.table)

a=data.table(Value=c(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15))

a[,merge:=Value]

b=data.table(Value=c(4,6,10,16))

b[,merge:=Value]

setkeyv(a,c('merge'))

setkeyv(b,c('merge'))

Merge_a_b=a[b,roll='nearest']
Merge_a_b
```
